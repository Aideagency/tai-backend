<!-- Delete Course Modal -->
<div
  id="deleteCourseModal"
  class="fixed inset-0 z-50 hidden items-center justify-center bg-black/40"
>
  <div class="bg-white rounded-2xl shadow-lg w-full max-w-sm p-6">
    <h3 class="text-sm font-semibold text-gray-800 mb-2">Confirm Delete</h3>

    <p class="text-xs text-gray-600 mb-4">
      Are you sure you want to delete
      <span id="deleteCourseTitle" class="font-semibold text-red-600"></span>?
      This action cannot be undone.
    </p>

    <div class="flex justify-end gap-2 mt-4">
      <button
        type="button"
        class="px-3 py-1.5 text-xs rounded-md border border-gray-300 text-gray-700 hover:bg-gray-100"
        onclick="closeDeleteCourseModal()"
      >
        Cancel
      </button>

      <button
        id="confirmDeleteCourseBtn"
        type="button"
        class="inline-flex items-center gap-2 px-3 py-1.5 text-xs rounded-md bg-red-600 text-white font-semibold hover:bg-red-700 disabled:opacity-60 disabled:cursor-not-allowed"
      >
        <span id="confirmDeleteCourseText">Delete</span>

        <!-- Spinner -->
        <svg
          id="confirmDeleteCourseSpinner"
          class="hidden animate-spin h-4 w-4 text-white"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
        >
          <circle
            class="opacity-25"
            cx="12"
            cy="12"
            r="10"
            stroke="currentColor"
            stroke-width="4"
          ></circle>
          <path
            class="opacity-75"
            fill="currentColor"
            d="M4 12a8 8 0 018-8v3a5 5 0 00-5 5H4z"
          ></path>
        </svg>
      </button>
    </div>
  </div>
</div>

<script>
  let selectedCourseId = null;

  function openDeleteCourseModal(btn) {
    const modal = document.getElementById("deleteCourseModal");
    if (!modal) return;

    selectedCourseId = btn.dataset.courseId;
    const title = btn.dataset.courseTitle || "";

    const titleSpan = document.getElementById("deleteCourseTitle");
    if (titleSpan) titleSpan.textContent = title;

    modal.classList.remove("hidden");
    modal.classList.add("flex");
  }

  function closeDeleteCourseModal() {
    const modal = document.getElementById("deleteCourseModal");
    if (!modal) return;

    modal.classList.add("hidden");
    modal.classList.remove("flex");
    selectedCourseId = null;

    const btn = document.getElementById("confirmDeleteCourseBtn");
    const text = document.getElementById("confirmDeleteCourseText");
    const spinner = document.getElementById("confirmDeleteCourseSpinner");

    if (btn && text && spinner) {
      btn.disabled = false;
      spinner.classList.add("hidden");
      text.textContent = "Delete";
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    const btn = document.getElementById("confirmDeleteCourseBtn");
    const text = document.getElementById("confirmDeleteCourseText");
    const spinner = document.getElementById("confirmDeleteCourseSpinner");

    if (!btn) return;

    btn.addEventListener("click", async () => {
      if (!selectedCourseId) return;

      try {
        btn.disabled = true;
        spinner.classList.remove("hidden");
        text.textContent = "Deleting...";

        // âœ… Update this route to match your backend
        // Common options you might have:
        // DELETE /admin/courses/:id
        // DELETE /admin/courses/archive/:id
        const res = await fetch(`/admin/courses/${selectedCourseId}`, {
          method: "DELETE",
          credentials: "include",
        });

        if (!res.ok) {
          btn.disabled = false;
          spinner.classList.add("hidden");
          text.textContent = "Delete";

          let msg = "Error deleting course.";
          try {
            const data = await res.json();
            msg = Array.isArray(data.message)
              ? data.message.join(", ")
              : data.message || msg;
          } catch (_) {}

          alert(msg);
          return;
        }

        window.location.reload();
      } catch (err) {
        console.error(err);
        btn.disabled = false;
        spinner.classList.add("hidden");
        text.textContent = "Delete";
        alert("Something went wrong.");
      }
    });
  });
</script>
